<!DOCTYPE html>
<html lang="sk">
    <head>
        <title>Bootstrap Example</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


        <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>


        <!-- Bootstrap Date-Picker Plugin -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/gijgo@1.9.3/combined/js/gijgo.min.js" type="text/javascript"></script>
        <link href="https://cdn.jsdelivr.net/npm/gijgo@1.9.3/combined/css/gijgo.min.css" rel="stylesheet" type="text/css" />
        <style>
            tr, label {
                cursor: pointer;
            }
            tr button {
                visibility: hidden;
            }
            tr:hover button {
                visibility: visible;
            }
            .hidden {
                display: none;
            }

            .buttons {
                text-align: right;
                width: 250px;
            }

            .buttons button {
                visibility: hidden;
            }

            tr:hover .buttons button {
                visibility: visible;
            }

            #imagePreview {
                width: 100%;
                height: 100%;
            }

            .cameraError {
                display: none;
                color: red;
            }
            .has-error .cameraError {
                display: block;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="row">
                
            </div>
            <div class="row">
                <div class="col-md-4 col-md-offset-3">
                    <!--<form action="" class="search-form">-->
                        <div class="form-group has-feedback">
                            <label for="search" class="sr-only">Hľadať</label>
                            <input type="text" class="form-control" name="search" id="search" placeholder="Hľadať">
                            <span class="glyphicon glyphicon-search form-control-feedback"></span>
                        </div>

                        <div class="container">
                            Start Date: <input id="startDate" width="276" />
                            End Date: <input id="endDate" width="276" />
                        </div>
                    <!--</form>-->
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a data-toggle="tab" href="#shots">
                                Snímky <span class="badge" id="shotsCount"></span>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="tab" href="#cameras">
                                Kamery <span class="badge" id="camerasCount"></span>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="tab" href="#options">
                                Nastavenia <span class="badge" id="optionsCount"></span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="tab-content">
                <div id="shots" class="tab-pane fade in active">
                    <table class="table table-hover" id="example">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Názov</th>
                            <th>Poznámka</th>
                            <th>Vytvorena</th>
                            <th>Kamera</th>
                            <th>Nastavenie</th>
                        </tr>
                        </thead>
                        <tbody id="tableShotsContent">
                        </tbody>
                    </table>
                </div>
                <div id="cameras" class="tab-pane fade">
                    <table class="table table-hover" id="tableCameras">
                        <thead>
                        <tr>
                            <th>Názov</th>
                            <th>Typ</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody id="tableCamerasContent">
                        </tbody>
                    </table>
                    <button type="button"
                            class="btn btn-primary"
                            onclick="show.cameraDetail('new')"
                            data-toggle="modal"
                            data-target="#detailCamForm">
                        Nová kamera
                    </button>
                </div>
                <div id="options" class="tab-pane fade">
                    <table class="table table-hover" id="tableOptions">
                        <thead>
                        <tr>
                            <th>Názov</th>
                            <th>Kamera</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody id="tableOptionsContent">
                        </tbody>
                    </table>
                    <button type="button"
                            class="btn btn-primary"
                            onclick="show.viewDetail('new')"
                            data-toggle="modal"
                            data-target="#detailViewForm">
                        Nové nastavenie
                    </button>
                </div>
            </div>
        </div>

        <!-- Detail modal -->
        <div id="detailModal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Modal Header</h4>
                    </div>
                    <div class="modal-body" id="detail-content">
                        <p id="urltoFile"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Preview modal - zobrazenie snimky -->
        <div id="previewModal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <img id="imagePreview"
                         src="https://static.pexels.com/photos/67636/rose-blue-flower-rose-blooms-67636.jpeg"
                         alt="preview">
                </div>
            </div>
        </div>

        <!-- zobrazenie obrazka z testu -->
        <!-- <div id="testPreviewModal" class="modal fade" role="dialog" style="z-index: 10">
            <div class="modal-dialog">
                <div class="modal-content">
                    <img id="testPreview" src=""/>
                    dghuognaduivbayubguigabgabgou
                </div>
            </div>
        </div> -->

        <!-- Camera detail form modal -->
        <div class="modal fade" id="detailCamForm">
            <div class="modal-dialog">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title">Detail kamery</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        <form action="#" id="cameraDetailForm">
                            <div class="form-group" id="cameraNameDiv">
                                <label for="cameraName">Nazov kamery:</label>
                                <input type="text" class="form-control" id="cameraName" name="cameraName">
                                <span class="glyphicon form-control-feedback"></span>
                                <span class="cameraError">Zadaný názov kamery už existuje</span>
                            </div>
                            <label for="cam">Typ kamery:</label>
                            <select id="cam" title="Typ kamery" class="form-control" name="cameraType">
                                <option value="" disabled>Vyberte typ kamery</option>
                                <option value="USB">USB Kamera</option>
                                <option value="IP">IP Kamera</option>
                            </select>

                            <div id="usb">
                                <div class="form-group">
                                    <label for="usbList">Zoznam USB kamier:</label>
                                    <select class="form-control" id="usbList" name="usbList">
                                    </select>
                                </div>
                            </div>

                            <div id="ip">
                                <div class="form-group">
                                    <label for="acc_name">Prihlasovacie meno:</label>
                                    <input type="text" class="form-control" name="acc_name" id="acc_name"/>
                                </div>
                                <div class="form-group">
                                    <label for="acc_pass">Prihlasovacie heslo:</label>
                                    <input type="text" class="form-control" name="acc_pass" id="acc_pass"/>
                                </div>
                                <div class="form-group">
                                    <label for="id_adrss">IP adresa kamery:</label>
                                    <input type="text" class="form-control" name="id_adrss" id="id_adrss"/>
                                </div>
                                <!--<input type="button" value="Test" />-->
                            </div>
                            
                            <div class="form-group">
                                <button type="button"
                                id="testButton"
                                class="btn btn-primary"
                                onclick="show.getImageFromCam()"
                                data-toggle="modal" >
                                <!-- data-target="#testPreviewModal"> -->
                                Test
                                </button>
                            </div>
                            <input type="hidden" name="actualId" id="actualCameraId">
                            <input type="button"
                                   value="Upraviť"
                                   class="btn btn-primary hidden"
                                   onclick="show.cameraDetail(null, false)"
                                   id="cameraDetailEdit"/>
                            <input type="button"
                                   value="Uložiť"
                                   onclick="handlers.cameraSave()"
                                   class="btn btn-primary hidden"
                                   id="cameraDetailSubmit"/>
                        </form>
                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" id="closeCameraDetailButton" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>

                </div>
            </div>
        </div>

        <!-- Option detail form modal -->
        <div class="modal fade" id="detailViewForm">
            <div class="modal-dialog">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title">Pridať nové nastavenie/pohľad</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        <form action="#" id="viewDetailForm">
                            <div class="form-group">
                                <label for="selectedCameraToOption">Kamera:</label>
                                <select class="js-example-basic-single"
                                        id="selectedCameraToOption"
                                        style="width: 100%"
                                        name="selectedCameraToOption"></select>
                            </div>
                            <div class="form-group">
                                <label for="optionName">Nazov nastavenia:</label>
                                <input type="text" class="form-control" id="optionName" name="optionName">
                            </div>

                            

                            <div class="form-group">
                                <label for="intervalmezdiFotkami">Interval medzi fotkami:</label>
                                <input type="time" 
                                class="form-control" 
                                id="intervalmezdiFotkami" 
                                name = "intervalmezdiFotkami" 
                                step="1">
                            </div>


                            <div class="form-group">
                                <label for="novaFotkaprichybeInterval">Interval opakovania pri chybe</label>

                                <input type="time"
                                       class="form-control"
                                       title="Nová kamera"
                                       id="novaFotkaprichybeInterval"
                                       name="novaFotkaprichybeInterval"
                                       step="1">

                                <label for="novaFotkaprichybePokusy">Počet opakovani pri cbybe</label>
                                <input type="number"
                                   class="form-control"
                                   title="Nová kamera"
                                   id="novaFotkaprichybePokusy"
                                   name="novaFotkaprichybePokusy"
                                   min="1">
                            </div>

                            <div class="form-group">
                                <label for="zmazfotkuStarsiu">Mazanie fotky staršej ako:</label>
                               

                                <input type="date"
                                       width="276"
                                       class="form-control"
                                       title="Zmazať fotku číslo"
                                       id="zmazfotkuStarsiu"
                                       name="zmazfotkuStarsiu"
                                       min="1">
                            </div>

                            <div class="form-group">
                                <label for="novaFotkaprichybePokusy">Ponechať počet snímok na serveri</label>
                               

                                <input type="number"
                                class="form-control"
                                title="Nová kamera"
                                id="novaFotkaprichybePokusy"
                                name="novaFotkaprichybePokusy"
                                min="1">
                            </div>

                            <div class="form-group">
                                <label for="rezimOd">Aplikovat toto nastavenie len v urcitych hodinach:</label>
                                <!--##TODO 2 timery sem dat -->

                                <input type="time"
                                       class="form-control"
                                       title="Režim"
                                       id="rezimOd"
                                       name = "rezimOd">

                                       <input type="time"
                                       class="form-control"
                                       title="Režim"
                                       id="rezimDo"
                                       name="rezimDo">
                            </div>

                            <div class="form-group">
                                <label for="greyscale">Šedý odtieň:</label>
                                <!--##TODO 2 timery sem dat -->
                                <input type="checkbox"
                                       id="greyscale"
                                       class="form-check-input"
                                       onchange="utils.disableInput('rezim', this.checked)"
                                       name="greyscale"
                                       >

                            </div>

                            <div class="form-group">
                                <label for="original">Uložit aj originál(bez filtrov):</label>
                               
                                <input type="checkbox"
                                       id="original"
                                       class="form-check-input"
                                       onchange="utils.disableInput('rezim', this.checked)"
                                       name="original"
                                       >

                            </div>

                            <div class="form-group">
                                <label for="biela">Akceptovať bielu snímku v %</label>
                                
                               

                                <input type="text"
                                       class="form-control"
                                       title="biela"
                                       id="biela"
                                       value="0"
                                       min="1"
                                       name="biela">
                            </div>

                            <div class="form-group">
                                <label for="cierna">Akceptovať čiernu snímku v %</label>
                              

                                <input type="text"
                                       class="form-control"
                                       title="cierna"
                                       id="cierna"
                                       value="0"
                                       min="1",
                                       name="cierna">
                            </div>

                            <div class="form-group">
                                <label for="Jas">Jas:</label>
                                
                                <select name = "Jas">
                                    <option value=""></option>
                                    <option value="1">ľavy horny roh</option>
                                    <option value="2">pravy horny roh</option>
                                    <option value="3">ľavy dolny roh</option>
                                    <option value="4">pravy dolny roh</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="prz_rezim">Pridať čas spravenia snímky na snímku:</label>
                                
                                <select name = "casNaSnimku">
                                    <option value=""></option>
                                    <option value="1">ľavy horny roh</option>
                                    <option value="2">pravy horny roh</option>
                                    <option value="3">ľavy dolny roh</option>
                                    <option value="4">pravy dolny roh</option>
                                </select>
                            </div>

                            <input type="hidden" name="actualOptionId" id="actualOptionId">
                            <input type="button"
                                   value="Upraviť"
                                   class="btn btn-primary hidden"
                                   onclick="show.viewDetail(null, false)"
                                   id="viewDetailEdit"/>

                                <input type="button"
                                   value="Uložiť"
                                   onclick="handlers.viewSave()"
                                   class="btn btn-primary hidden"
                                   id="viewDetailSubmit"/>
                            
                        </form>
                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>

                </div>
            </div>
        </div>

        <script type="text/javascript">
            class Camera {
                constructor(id, name, login, password, ip, type, descriptor){
                    this.login = login;
                    this.id = id;
                    this.password = password;
                    this.ip = ip;
                    this.name = name;
                    this.type = type;
                    this.descriptor = descriptor;
                }
                static parse(camera) {
                    return new Camera(
                        camera.id || camera.k_id,
                        camera.meno || camera.k_nazov || camera.nazov,
                        camera.prihlasovacie_meno,
                        camera.prihlasovacie_heslo,
                        camera.ip,
                        camera.typ || camera.k_typ,
                        camera.descriptor
                    );
                }
            }
            class View {
                constructor(id, name, greyscale, photoInterval, deleteInterval, timeFrom, timeTo, camera, motionDetection, photoIntervalWithError) {
                    this.greyscale = greyscale;
                    this.timeTo = timeTo;
                    this.id = id;
                    this.photoInterval = photoInterval;
                    this.deleteInterval = deleteInterval;
                    this.timeFrom = timeFrom;
                    this.camera = camera;
                    this.motionDetection = motionDetection;
                    this.photoIntervalWithError = photoIntervalWithError;
                    this.name = name;
                }

                static parse(view) {
                    return new View(
                        view.id || view.n_id,
                        view.meno || view.n_nazov,
                        view.greyscale,
                        view.interval_medzi_fotkami,
                        view.interval_mazania_fotky,
                        view.cas_od,
                        view.cas_do,
                        new Camera(view.id_kamera, view.n_kamera_meno || "unknown camera name"),
                        view.prz_motion_detektor,
                        view.nova_fotka_pri_chybe,
                    )
                }
            }
            class Shot {
                constructor(created, note, id, name, camera, view, previewUrl) {
                    this.created = created;
                    this.note = note;
                    this.id = id;
                    this.name = name;
                    this.previewUrl = previewUrl;
                    this.camera = camera;
                    this.view = view;
                }
                static parse(shot) {
                    return new Shot(
                        shot.Vytvorena,
                        shot.poznamka,
                        shot.id,
                        shot.nazov,
                        new Camera(1, shot.kamera || "unknown camera name"),
                        new View(1, shot.nastavenie || "unknown view name"),
                        shot.previewUrl
                    )
                }
            }

            // const API_URL = "http://127.0.0.1:8081/browse";
            const API_URL = "http://10.1.254.214:8081/browse";
            //const API_URL = "https://raw.githubusercontent.com/Burk0/webserver-python/master/Model/Jsons/initData.json";
            const POSTFIX_INIT = "initData";
            const POSTFIX_CAMERA = "KameraDetail";
            const POSTFIX_SHOT = "SnimkaDetail";
            const POSTFIX_VIEW = "ViewDetail";
            const POSTFIX_USB_CAM = "UsbCams";
            const POSTFIX_AddCam = "AddCam";
            const POSTFIX_AddView = "AddView";
            const POSTFIX_DEC_VIEW = "DelView";
            const POSTFIX_TEST_CAM = "testCam";

            const elements = {
                searchInput: document.getElementById("search"),
                camerasBody: document.getElementById("tableCamerasContent"),
                camerasCount: document.getElementById("camerasCount"),
                optionsBody: document.getElementById("tableOptionsContent"),
                optionsCount: document.getElementById("optionsCount"),
                shotsBody: document.getElementById("tableShotsContent"),
                shotsCount: document.getElementById("shotsCount"),
                startDate: document.getElementById("startDate"),
                endDate: document.getElementById("endDate"),
            };

            const data = {
                cameras: [],
                views: [],
                shots: []
            };

            const utils = {
                getParameterByName(name, url = location.href){
                    if (!url) {
                        url = window.location.href;
                    }
                    name = name.replace(/[\[\]]/g, "\\$&");
                    const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
                    const results = regex.exec(url);
                    if (!results) return null;
                    if (!results[2]) return '';
                    return decodeURIComponent(results[2].replace(/\+/g, " "));
                },
                disableInput(inputId, isDisabled, shouldClearElement = false) {
                    const element = document.getElementById(inputId);
                    if (element) {
                        element.disabled = isDisabled;
                        if (isDisabled && shouldClearElement) {
                            element.value = "";
                        }
                    }
                },
                setAndDisable(element, value, disabled){
                    if (element.type === "checkbox") {
                        element.checked = !!value;
                    }
                    else {
                        element.value = value;
                    }
                    element.disabled = disabled;
                }
            };

            const handlers = {
                cameraSave() {
                    const inputActualCameraId = document.getElementById("actualCameraId");
                    const cameraData = $("#cameraDetailForm").serialize();

                    console.log("cameraData: ", cameraData);
                    if (inputActualCameraId.value === "new") {
                        //new
                        // if (false) {
                        //     console.log("OKEj");
                        //         $("#closeCameraDetailButton").click();
                        //     }
                        //     else {
                        //         var element = document.getElementById("cameraNameDiv");
                        //         element.classList.add("has-error");
                        //         element.classList.add("has-feedback");
                        //     }

                        //TODO
                        $.getJSON(API_URL + "/" + POSTFIX_AddCam, cameraData, (result) => {
                            console.log(result[0].return)
                            if (result[0].return === "false") {
                                const element = document.getElementById("cameraNameDiv");
                                element.classList.add("has-error");
                                element.classList.add("has-feedback");
                            }
                            else {
                                data.cameras.push(new Camera(result[0].return.actualId[0],
                                                             result[0].return.cameraName[0],
                                                             result[0].return.acc_name[0],//LOGIN
                                                             result[0].return.acc_pass[0],
                                                             result[0].return.id_adrss[0],
                                                             result[0].return.cameraType[0],
                                                             result[0].return.id_adrss[0]));
                                set.cameras();
                                $("#closeCameraDetailButton").click();
                            }
                        });
                    }
                    else {
                        // TODO toto sa volá pri update kamery
                    }
                },


                viewSave() {
                    
                    const inputActualCameraId = document.getElementById("actualOptionId");
                    const viewDataArray = $("#viewDetailForm").serializeArray();
                    const viewData = viewDataArray.map(e => {
                        if (e.name === "") {}
                    }).map(e => e.name + "=" + e.value).join("&");
                    console.log("viewData: ", viewData);
                    if (inputActualCameraId.value === "new") {
                        console.log("viewSAVE");
                        $.getJSON(API_URL + "/" + POSTFIX_AddView, viewData, (result) => {
                            console.log(result[0].return)
                            if (result[0].return === "false") {
                                const element = document.getElementById("cameraNameDiv");
                                element.classList.add("has-error");
                                element.classList.add("has-feedback");
                            }
                            else {
                                $("#closeCameraDetailButton").click();

                            }
                        });
                    }
                    else {
                        // TODO update
                    }

                }
            };

            const remove = {
                camera(index) {
                    data.cameras.splice(index, 1);
                    set.cameras();
                },
                option(index) {
                    data.views.splice(index, 1);
                    set.options();

                },
                shot(index) {
                    data.shots.splice(index, 1);
                    set.shots();
                    // $("#tableShotsContent").find("tr:nth-child(" + index + ")").remove();
                }
            };

            const show = {
                getImageFromCam() {
                // var e = document.getElementById("usbList");
                // var choice = e.option[e.selectedIndex].text;
                // console.log("volba" + choice);
                const cameraData = $("#cameraDetailForm").serialize();
                console.log("cameraData:", cameraData);
                window.open(API_URL + "/" + POSTFIX_TEST_CAM +cameraData);
                // $.getJSON(API_URL + "/" + POSTFIX_TEST_CAM,cameraData, (result) => {
                       
                //     });

                },

                shotDetail(index) {
                    console.log("volam tuto " + data.shots[index].previewUrl)
                    document.getElementById("urltoFile").innerHTML = data.shots[index].previewUrl;

                },
                openDetail(index) {
                    const imageElement = document.getElementById("imagePreview");
                    const selectedImage = data.shots[index];
                    console.log("otvaram img", imageElement)
                    if (!selectedImage) {
                        throw new Error("neplatná kamera s id: ", index);
                    }
                    imageElement.setAttribute("src", "/browse"+selectedImage.previewUrl);
                },
                cameraDetail(cameraId = "new", disabled) {
                    $(".has-error").removeClass("has-error");
                    const buttonEdit = document.getElementById("cameraDetailEdit");
                    const buttonSubmit = document.getElementById("cameraDetailSubmit");

                    const inputActualCameraId = document.getElementById("actualCameraId");

                    const inputCameraName = document.getElementById("cameraName");
                    const inputCamera = document.getElementById("acc_name");
                    const inputPassword = document.getElementById("acc_pass");
                    const inputIpAddress = document.getElementById("id_adrss");
                    const inputCameraType = document.getElementById("cam");
                    console.log("inputCameraType: ", inputCameraType);
                    const camera = data.cameras[cameraId];

                    $.getJSON(API_URL + "/" + POSTFIX_USB_CAM, (result) => {
                        const usbCamerasSelect = document.getElementById("usbList");
                        let body = "";
                        result.forEach((item) => {
                            body += `
                                <option value="${item.desc}">${item.name}</option>
                            `;
                        });
                        usbCamerasSelect.innerHTML = body;
                    });


                    disabled = typeof disabled === "undefined" ? cameraId !== "new" : disabled;

                    buttonEdit.classList.toggle("hidden", !disabled);
                    buttonSubmit.classList.toggle("hidden", disabled);

                    // vytvára sa nová kamera
                    if (cameraId === "new") {
                        utils.setAndDisable(inputCamera, "", disabled);
                        utils.setAndDisable(inputPassword, "", disabled);
                        utils.setAndDisable(inputIpAddress, "", disabled);
                        utils.setAndDisable(inputActualCameraId, "new", disabled);
                        utils.setAndDisable(inputCameraType, "IP", disabled);
                        utils.setAndDisable(inputCameraName, "", disabled);
                    }
                    // iba sa mení disablovanie inputov
                    else if (typeof cameraId === "object"){
                        utils.setAndDisable(inputCamera, inputCamera.value, disabled);
                        utils.setAndDisable(inputPassword, inputPassword.value, disabled);
                        utils.setAndDisable(inputIpAddress, inputIpAddress.value, disabled);
                        utils.setAndDisable(inputCameraType, inputCameraType.value, disabled);
                        utils.setAndDisable(inputActualCameraId, inputActualCameraId.value, disabled);
                        utils.setAndDisable(inputCameraName, inputCameraName.value, disabled);
                    }
                    // zobrazuje sa detail
                    else {
                        $.getJSON(API_URL + "/" + POSTFIX_CAMERA + "/" + camera.id , (cameraDetail) =>{
                            cameraDetail = Camera.parse(cameraDetail);
                            console.log("Po response ", cameraDetail.type)
                            utils.setAndDisable(inputCamera, cameraDetail.login, disabled);
                            utils.setAndDisable(inputPassword, cameraDetail.password, disabled);
                            utils.setAndDisable(inputIpAddress, cameraDetail.ip, disabled);
                            utils.setAndDisable(inputCameraType, cameraDetail.type, disabled);
                            utils.setAndDisable(inputActualCameraId, cameraDetail.value, disabled);
                            utils.setAndDisable(inputCameraName, cameraDetail.name, disabled);
                            document.getElementById("cam").onchange({
                                target: document.getElementById("cam"),
                            });
                            document.getElementById("testButton").classList.add("hidden");
                        });
                    }
                    document.getElementById("cam").onchange({
                        target: document.getElementById("cam"),
                    });
                    document.getElementById("testButton").classList.remove("hidden");
                },
                viewDetail(optionId = "new", disabled) {
                    const buttonEdit = document.getElementById("viewDetailEdit");
                    const buttonSubmit = document.getElementById("viewDetailSubmit");
                    
                    const inputActualOptionId = document.getElementById("actualOptionId");
                    const inputOptionCamera = document.getElementById("selectedCameraToOption");
                    const inputOptionName = document.getElementById("optionName");
                    
                    const inputOptionIntervalShot = document.getElementById("intervalmezdiFotkami");
                    const inputOptionIntervalError = document.getElementById("novaFotkaprichybeInterval");
                    const inputOptionTryErrro = document.getElementById("novaFotkaprichybePokusy");

                    const inputOptionOlderDel = document.getElementById("zmazfotkuStarsiu");
                    const inputOptionCountDel = document.getElementById("novaFotkaprichybePokusy");
                    const inputOptionRezimFrom = document.getElementById("rezimOd");
                    const inputOptionRezimTo = document.getElementById("rezimTo");

                    const inputOptiongreyscale = document.getElementById("greyscale");

                    const inputOptionoriginal = document.getElementById("original");
                    const inputOptionWhite = document.getElementById("biela");
                    const inputOptionBlack = document.getElementById("cierna");
                    const inputOptionJas = document.getElementById("Jas");
                    const inputOptionTimeOnShot = document.getElementById("casNaSnimku");

                   

                    const Option = data.views[optionId];

                    disabled = typeof disabled === "undefined" ? optionId !== "new" : disabled;

                    buttonEdit.classList.toggle("hidden", !disabled);
                    buttonSubmit.classList.toggle("hidden", disabled);

                    // vytvára sa nove nastavenie 
                    if (optionId === "new") {
                        utils.setAndDisable(inputActualOptionId, "new", disabled);
                        utils.setAndDisable(inputOptionCamera, "", disabled);
                        utils.setAndDisable(inputOptionName, "", disabled);
                        utils.setAndDisable(inputOptionIntervalShot,"",disabled);
                        utils.setAndDisable(inputOptionIntervalError,"",disabled);
                        utils.setAndDisable(inputOptionTryErrro,"",disabled);
                        utils.setAndDisable(inputOptionOlderDel,"",disabled);
                        utils.setAndDisable(inputOptionCountDel,"",disabled);
                        utils.setAndDisable(inputOptionRezimFrom,"",disabled);
                        utils.setAndDisable(inputOptionRezimTo,"",disabled);
                        utils.setAndDisable(inputOptiongreyscale,"",disabled);
                        utils.setAndDisable(inputOptionoriginal,"",disabled);
                        utils.setAndDisable(inputOptionWhite,"",disabled);
                        utils.setAndDisable(inputOptionBlack,"",disabled);
                        utils.setAndDisable(inputOptionJas,"",disabled);
                        utils.setAndDisable(inputOptionTimeOnShot,"",disabled);
                        
                    }
                    // iba sa mení disablovanie inputov
                    else if (typeof optionId === "object"){
                        utils.setAndDisable(inputActualOptionId, inputActualOptionId.value, disabled);
                        utils.setAndDisable(inputOptionCamera, inputOptionCamera.value, disabled);
                        utils.setAndDisable(inputOptionName, inputOptionName.value, disabled);
                        utils.setAndDisable(inputOptionIntervalShot,inputOptionIntervalShot.value,disabled);
                        utils.setAndDisable(inputOptionIntervalError,inputOptionIntervalError.value,disabled);
                        utils.setAndDisable(inputOptionTryErrro,inputOptionTryErrro.value,disabled);
                        utils.setAndDisable(inputOptionOlderDel,inputOptionOlderDel.value,disabled);
                        utils.setAndDisable(inputOptionCountDel,inputOptionCountDel.value,disabled);
                        utils.setAndDisable(inputOptionRezimFrom, inputOptionRezimFrom.value,disabled);
                        utils.setAndDisable(inputOptionRezimTo, inputOptionRezimTo.value,disabled);
                        utils.setAndDisable(inputOptiongreyscale, inputOptiongreyscale.value,disabled);
                        utils.setAndDisable(inputOptionoriginal,inputOptionoriginal.value,disabled);
                        utils.setAndDisable(inputOptionWhite,inputOptionWhite.value,disabled);
                        utils.setAndDisable(inputOptionBlack,inputOptionBlack.value,disabled);
                        utils.setAndDisable(inputOptionJas,inputOptionJas.value,disabled);
                        utils.setAndDisable(inputOptionTimeOnShot,inputOptionTimeOnShot.value,disabled);
                    }
                    // zobrazuje sa detail
                    else {
                        $.getJSON(API_URL + "/" + POSTFIX_VIEW + "/" + Option.id, (Option) => {
                            Option = View.parse(Option[0]);
                            //TODO
                            utils.setAndDisable(inputOptionCamera, Option.camera.id, disabled);
                            utils.setAndDisable(inputOptionName, Option.name, disabled);
                            utils.setAndDisable(inputOptionMotionDetect, !!Option.photoInterval, disabled);
                            utils.setAndDisable(inputOptionMotionDetectDelay, Option.photoInterval, disabled);
                            utils.setAndDisable(inputPhotoOnMove, !!Option.motionDetection, disabled);
                            utils.setAndDisable(inputPhotoOnMoveValue, Option.motionDetection, disabled);
                            utils.setAndDisable(inputDeletePhoto, !!Option.deleteInterval, disabled);
                            utils.setAndDisable(inputDeletePhotoValue, Option.deleteInterval, disabled);
                            utils.setAndDisable(inputActiveTime, Option.timeFrom || Option.timeTo, disabled);
                            utils.setAndDisable(inputActiveTimeValue, [Option.timeFrom, Option.timeTo].join(" - "), disabled);
                            utils.setAndDisable(inputActualOptionId, viewDetail.value, disabled);
                        });
                    }
                },
                detail(item) {
                    const params = {};
                    //posleme HTTP request
                    $.post(API_URL + "/detail/" + item, params, () => {
                        console.log(params);
                    }, "json");
                }
            };

            const init = {
                main() {
                    const params = {};


                    elements.startDate.onchange = elements.endDate.onchange = elements.searchInput.onkeyup = () => {
                        // if (event.keyCode === 13) { //Enter
                        // alert("vyhladávam slovo: " + event.target.value);
                        set.cameras();
                        set.options();
                        set.shots();
                        // }
                    };


                    $.getJSON(API_URL + "/" + POSTFIX_INIT, (response) => {
                        while(data.cameras.length){
                            data.cameras.splice(0, 1);
                        }
                        data.cameras.push.apply(data.cameras, response.cams.map(Camera.parse));
                        set.cameras();

                        while(data.views.length){
                            data.views.splice(0, 1);
                        }
                        data.views.push.apply(data.views, response.views.map(View.parse));
                        set.options();


                        while(data.shots.length){
                            data.shots.splice(0, 1);
                        }
                        data.shots.push.apply(data.shots, response.snimky.map(Shot.parse));
                        set.shots();

                        const html = "<option></option>" + data.cameras.map((camera) => {
                            return `<option value="${camera.id}">${camera.name}</option>`;
                        }).join("");
                        $('.js-example-basic-single').html(html).select2({
                            placeholder: 'Kamera pre ktorú sú určené nastavenia',
                            allowClear: true
                        });
                    })
                },
                view() {
                    $("#addViewSubmit").click(function () {
                        
                        $.post("URL/addView", JSON.stringify( $("form").serialize()), function (response) {
                            console.log("response: ", response);
                        })
                    });
                },
                camera() {
                    const camElement = document.getElementById("cam");
                    const ipElement = document.getElementById("ip");
                    const usbElement = document.getElementById("usb");
                    /*
                    $("#cameraDetailSubmit").click(function () {
                        console.log("volaaaaaaaaaaaaaaam");
                        $.post(API_URL + "/addCam", JSON.strigify($("form").serialize()), function (response) {
                            console.log("response: ", response);
                        })
                    });
                    */

                    function onChangeCameraType() {
                            const value = camElement.options[camElement.selectedIndex].value;
                            ipElement.classList.add("hidden");
                            usbElement.classList.add("hidden");
                            console.log("typ kamery: ", value);
                            switch (value) {
                                case "IP": 
                                    ipElement.classList.remove("hidden");
                                    break;
                                case "USB": 
                                    usbElement.classList.remove("hidden");
                                    break;
                                default:
                                    alert("neplatný typ kamery: " + value);
                            }
                    }

                    camElement.onchange = onChangeCameraType;
                    onChangeCameraType();
                }
            };

            const set = {
                cameras() {
                    const searchKey = elements.searchInput.value.toLowerCase();
                    let innerHtml = "";
                    let count = 0;
                    data.cameras.forEach((camera, index) => {
                        if (searchKey &&
                            camera.name.toLowerCase().indexOf(searchKey) < 0 &&
                            camera.type.toLowerCase().indexOf(searchKey) < 0) {
                            return;
                        }
                        count++;
                        innerHtml += `
                        <tr>
                            <td>${camera.name}</td>
                            <td>${camera.type}</td>
                            <td>
                                <button type="button"
                                        class="btn btn-default btn-sm"
                                        onclick="show.cameraDetail(${index})"
                                        data-toggle="modal"
                                        data-target="#detailCamForm">
                                    <span class="glyphicon glyphicon-info-sign"></span>
                                </button>
                                <button type="button"
                                        class="btn btn-default btn-sm"
                                        onclick="show.cameraDetail(${index}, false)"
                                        data-toggle="modal"
                                        data-target="#detailCamForm">
                                    <span class="glyphicon glyphicon-edit"></span>
                                </button>
                                <button type="button"
                                        class="btn btn-default btn-sm"
                                        onclick="remove.camera(${index})">
                                    <span class="glyphicon glyphicon-trash"></span>
                                </button>
                            </td>
                        </tr>
                    `
                    });
                    elements.camerasCount.innerText = count;
                    elements.camerasBody.innerHTML = innerHtml;
                },
                options() {
                    const searchKey = elements.searchInput.value.toLowerCase();
                    elements.optionsCount.innerText = data.views.length;
                    let innerHtml = "";
                    let count = 0;
                    data.views.forEach((view, index) => {
                        if (searchKey &&
                            view.name.toLowerCase().indexOf(searchKey) < 0 &&
                            view.camera.name.toLowerCase().indexOf(searchKey) < 0 ) {
                            return;
                        }
                        count++;
                        innerHtml += `
                        <tr>
                            <td>${view.name}</td>
                            <td>${view.camera.name}</td>
                            <td>
                                <button type="button"
                                        class="btn btn-default btn-sm"
                                        onclick="show.viewDetail(${index})"
                                        data-toggle="modal"
                                        data-target="#detailViewForm">
                                    <span class="glyphicon glyphicon-info-sign"></span>
                                </button>
                                <button type="button"
                                        class="btn btn-default btn-sm"
                                        onclick="show.viewDetail(${index}, false)"
                                        data-toggle="modal"
                                        data-target="#detailViewForm">
                                    <span class="glyphicon glyphicon-edit"></span>
                                </button>
                                <button type="button"
                                        class="btn btn-default btn-sm"
                                        onclick="remove.option(${index})">
                                    <span class="glyphicon glyphicon-trash"></span>
                                </button>
                            </td>


                        </tr>
                    `
                    });
                    elements.optionsCount.innerText = count;
                    elements.optionsBody.innerHTML = innerHtml;
                },
                shots() {
                    const searchKey = elements.searchInput.value.toLowerCase();
                    elements.shotsCount.innerText = data.views.length;
                    let innerHtml = "";
                    let count = 0;
                    const startDate = new Date(elements.startDate.value);
                    const endDate = new Date(elements.endDate.value);
                    data.shots.forEach((shot, index) => {
                        const shotCreated = new Date(shot.created);
                        if ((searchKey &&
                            shot.name.toLowerCase().indexOf(searchKey) < 0 &&
                            shot.note.toLowerCase().indexOf(searchKey) < 0 &&
                            shot.view.name.toLowerCase().indexOf(searchKey) < 0 &&
                            shot.camera.name.toLowerCase().indexOf(searchKey) < 0 )
                            ||
                            ((!isNaN(startDate.getTime()) && startDate.getTime() >= shotCreated.getTime()) ||
                             (!isNaN(endDate.getTime()) && endDate.getTime() <= shotCreated.getTime()))) {
                            return;
                        }
                        count++;
                        innerHtml += `
                        <tr>
                            <td>${shot.id}</td>
                            <td>${shot.name}</td>
                            <td>${shot.note}</td>
                            <td>${shot.created.substring(0, 10)}</td>
                            <td>${shot.camera.name}</td>
                            <td>${shot.view.name}</td>
                            <td>
                            <button type="button"
                                        class="btn btn-default btn-sm"
                                        onclick="show.shotDetail(${index})"
                                        data-toggle="modal"
                                        data-target="#detailModal">
                                    <span class="glyphicon glyphicon-info-sign"></span>
                                </button>
                                <button type="button"
                                        class="btn btn-default btn-sm"
                                        onclick="show.openDetail(${index}, false)"
                                        data-toggle="modal"
                                        data-target="#previewModal">
                                    <span class="glyphicon glyphicon-edit"></span>
                                </button>
                                <button type="button"
                                        class="btn btn-default btn-sm"
                                        onclick="remove.shot(${index})">
                                    <span class="glyphicon glyphicon-trash"></span>
                                </button>
                            </td>
                        </tr>
                    `
                    });
                    elements.shotsCount.innerText = count;
                    elements.shotsBody.innerHTML = innerHtml;
                }
            };

            // ak sa načíta dokument tak za zavolajú všetky inicializačné metódy
            $(function () {
                elements.searchInput.value = utils.getParameterByName("search");

                init.main();
                init.view();
                init.camera();
            });



        //var today = new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate());
        $('#startDate').datepicker({
            uiLibrary: 'bootstrap4',
            iconsLibrary: 'fontawesome',
            format: 'mm.dd.yyyy',
            // minDate: today,
            maxDate: function () {
                return $('#endDate').val();
            }
        });
        $('#endDate').datepicker({
            uiLibrary: 'bootstrap4',
            format: 'mm.dd.yyyy',
            iconsLibrary: 'fontawesome',
            minDate: function () {
                return $('#startDate').val();
            }
        });
        $('#delDate').datepicker({
            uiLibrary: 'bootstrap4',
            format: 'mm.dd.yyyy',
            iconsLibrary: 'fontawesome',
           
        });

        </script>
    </body>
</html>
